{% extends 'base.html' %}
{% load url from future %}
{% load extra_tags %}
{% load django_bootstrap_breadcrumbs %}

{% block breadcrumbs %}
    {{ block.super }}
    {% breadcrumb "All databases" "alldatabases" %}
    {% breadcrumb "Data table" "alldatabases/data-table" %}


{% endblock %}


{% block headextra %}
<link rel="stylesheet" href="static/css/theme.blue.css">
{% endblock %}


{% block scriptextraincludes %}
<script src="static/js/vendor/jquery.tablesorter.min.js"></script>
<script src="static/js/vendor/jquery.tablesorter.widgets.js"></script>

        
        <script type="text/javascript" language="javascript" src="static/js/jquery.dataTables.js"></script>
        <script type="text/javascript" charset="utf-8">
            $(document).ready(function() {
            /*    $('#table_databases').dataTable( {
                        "sScrollY": 200,
                    "sScrollX": "200%",
                    "sScrollXInner": "210%",
                    "bScrollCollapse": true,
                    
                } );
*/
                // Add handlers to the db type selector
                $('#db_type').change(function(){
                    var value_selected = $(this).val();
                    if(value_selected == '0'){
                        $('.qsets').each(function(){
                            $(this).addClass('depon_class');
                        });
                    } else {
                        $('.qsets').each(function(){
                            if($(this).attr('id') == 'q_select_'+value_selected){
                                $(this).removeClass('depon_class');
                                $(this).val('0');
                            } else 
                                $(this).addClass('depon_class');
                        });
                    }
                });
                $('.qsets').change(function(){
                    var db_selected = $('#db_type').val();
                    var qset_selected = $(this).val();
                    //alert(qset_selected);
                    $('#tabular_container').html("Loading...");
                    $.post( "qs_data_table", {db_type: db_selected, qset: qset_selected })
                      .done(function( data ) {
                        $('#tabular_container').html(data);
                      });
                });
            });


             
        </script>


{% endblock %}

{% block styleextra %}

button {
    border: 1px #AAA solid;
    padding: 4px 10px;
}
.hide {
    display: none;
}

{% endblock %}


{% block toolbar %}
{% include "menu_toolbar.html" %}

{% endblock %}

{% block content %}

{% if list_databases %}
<div style="margin-bottom: 70px;"></div>



<select id="db_type">
<option value="0">-- Select a database type</option>
{% for k in databases_types  %}
 <option value="{{k}}">{{k}}</option>
{% endfor %}
</select>

{% for k, qsets in databases_types.items  %}
<select id="q_select_{{k}}" class="depon_class qsets">
<option value="0">-- Select a questionset</option>
    {% for text, ref in qsets  %}
     <option value="{{text}}">{{text|removeh1}}</option>
    {% endfor %}
</select>
{% endfor %}

<div id="tabular_container" class="pull-center">
To see a tabular view of all databases, please choose a database type and a questionset.
</div>


{% else %}
<div class="row">
<div class="span4">
<div class="alert">
  <a class="close" data-dismiss="error">Ã—</a>
  <strong>Info</strong> Please add a new database, like for instance a Cohort or Observation. You can find this option in the menu "Workspace -> Add -> Research Cohort or Observation Study"
</div>
</div>
</div>
{% endif %}

{% comment %}
  <a class="btn btn-large btn-success" href="advancedSearch/1">Add new database</a>
{% endcomment %}
</div>



{% endblock %}

{% block scriptextra %}
{% comment %}
<script>
{% endcomment %}


$('#li_workspace').addClass("active");


{% comment %}
</script>
{% endcomment %}

{% endblock %}