{% extends 'base.html' %}
{% load url from future %}
{% load extra_tags %}
{% block styleextra %}
    


   table {
  table-layout: fixed;
}
th, td {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  -o-text-overflow: ellipsis;
  -ms-text-overflow: ellipsis;
}

.tooltip.in {
  opacity: 0.8;
  filter: alpha(opacity=80);
}
.tooltip.in {
  opacity: 1;
  filter: alpha(opacity=100);
}



{% endblock %}
{% block content %}
<div class="span12">
  <div class="accordion" id="accordion2">
    {% for name, qset in results %}

    <div class="span3">
      <span class="label label-inverse">{{name}}</span>

      {% for k,v in qset.items %}
      <div class="accordion-group">
        <div class="accordion-heading">
          <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse{{k|removespaces}}{{name|removespaces}}">{{k|removeh1}}</a>
        </div>
        <div id="collapse{{k|removespaces}}{{name|removespaces}}" class="accordion-body collapse">
          <div class="accordion-inner">

            <table id="{{name|removespaces}}_{{k|removespaces}}" class="table table-bordered  table-hover table-striped">
              <thead></thead>

              <tbody>
                {% for t in v.list_ordered_tags %}
                <tr>
                  <td data-original-title="{{ t.tag }}" title="">{{ t.tag }}</td> 
                   <td data-original-title="{{ t.value }}" title=""> {{ t.value }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endfor %}
  </div>
</div>
</div>  

{% endblock %}

{% block scriptextra %}
function hidecheckbox()
{
  $('.checkbox').toggle();
}

/*

function highlight(text, text_to_highlight)
{
    inputText = document.getElementById("inputText")
    var innerHTML = inputText.innerHTML
    var index = innerHTML.indexOf(text);
    if ( index >= 0 )
    { 
        innerHTML = innerHTML.substring(0,index) + "
<span class='highlight'>" + innerHTML.substring(index,index+text.length) + "</span>
" + innerHTML.substring(index + text.length);
        inputText.innerHTML = innerHTML 
    }

}

*/

$.fn.textWidth = function() {
  var node, original, width;
  original = $(this).html();
  node = $("<span style='position:absolute;width:auto;left:-9999px'>" + original + "</span>");
  //node.css('font-family', $(this).css('font-family')).css('font-size', $(this).//css('font-size'));
  $('body').append(node);
  width = node.width();
  node.remove();
  return width;
};

$(function() {
  $('td').each(function() {

    var content;
    content = $(this).text().replace(/\s+/gi, ' ');

    
    if ($(this).textWidth() > $(this).width()) {
    
      return $(this).tooltip({container:"body"});
    }
  });
});


compare_cell = function(table, cell_name, value)
{ 
  var result_final = 0;
  console.log("Cellname: " + cell_name.data);
  console.log("Value: " + value.data);
     $('#'+ table).each(function() {
      //console.log($(this.childNodes[3].childNodes));
       $(this.childNodes[3].childNodes).each(function()
      {
        //console.log($(this.childNodes));
       $(this).each(function()
        { 
            if (this.tagName=="TR")
            {
              $('#t11').addClass("warning");
              $(this.childNodes[1]).addClass("success");
              try
              {
              if ($(this.childNodes[1].childNodes[0]).context.data==cell_name.data)
              {
                console.log("FOUND: " + value.data);
                console.log($(this.childNodes[3].childNodes[0])[0].textContent);
                //if (value.data.indexOf($(this.childNodes[3].childNodes[0]).context) !== -1))
              if ($(this.childNodes[3].childNodes[0])[0].textContent.indexOf(value.data) !== -1)
                {
                  console.log("True: " + value.data);
                  result_final = 1;
                  return false;
                }
                $(this.childNodes[1]).addClass("success");
                $(this.childNodes[1]).add("found");
                //console.log($(this.childNodes[1]));
              }
              //console.log($(this.childNodes[1].childNodes[0]).context);
              //console.log($(this.childNodes[3].childNodes[0]).context);
              }
              catch (err) 
              {
                console.log(err.message)

              }
              //console.log($(this)); 
            }
        }   
        );    
        
      }
      
      );
    });
    return result_final;
}

comparetable = function(table1, table2){
  // Compare two tables: highlight the differences
  $(function() {

    $('#'+ table1).each(function() {
      //console.log($(this.childNodes[3].childNodes));
      $(this.childNodes[3].childNodes).each(function()
      {
        //console.log($(this.childNodes));
      $(this).each(function()
        { 
            if (this.tagName=="TR")
            {
              //console.log($(this.childNodes[1].childNodes[0]).context);
              //console.log($(this.childNodes[3].childNodes[0]).context);
              
              var result = compare_cell(table2, $(this.childNodes[1].childNodes[0]).context,$(this.childNodes[3].childNodes[0]).context);
              console.log('Result: ' + result );
              if (result==1)
                $(this).addClass("success");
              else
                $(this).addClass("error");
              //console.log($(this)); 
            }
        }   
        );    
        
      }

  );

    $('td').each(function()
    {
      console.log("das");
    }

      );
    var content;
    content = $(this).text().replace(/\s+/gi, ' ');
    //console.log(content)


  });
  $('#'+ table2).each(function() {

    var content;
    content = $(this).text().replace(/\s+/gi, ' ');
    //console.log(content)

  });
    
  });


}

{% for name, qset in results %}


{% for k,v in qset.items %}
{{name|removespaces}}_{{k|removespaces}}
comparetable('das_{{k|removespaces}}','{{name|removespaces}}_{{k|removespaces}}')
{% endfor %}



{% endfor %}








{% endblock %}