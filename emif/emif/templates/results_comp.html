{% extends 'base.html' %}
{% load url from future %}
{% load extra_tags %}
{% load django_bootstrap_breadcrumbs %}

{% block breadcrumbs %}
    {{ block.super }}
    {% breadcrumb "Compare Databases" "" %}

{% endblock %}

{% block scriptextraincludes %}
<script src="static/js/vendor/tablediff.js"></script>

{% endblock %}


{% block styleextra %}
    


   table {
  table-layout: fixed;
}
th, td {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  -o-text-overflow: ellipsis;
  -ms-text-overflow: ellipsis;
}

.tooltip.in {
  opacity: 0.8;
  filter: alpha(opacity=80);
}
.tooltip.in {
  opacity: 1;
  filter: alpha(opacity=100);
}

{% endblock %}


{% block toolbar %}
<form id="result_form" action="resultscomp" method="POST">
  {% csrf_token %}
  <div class="span6">
    <div class="btn-group pull-right">

      <div class="btn-group"></div>
      
      <a id="collapseall" class="btn" href="" >
        Expand all
      </a>

      

      <div class="btn-group">
        <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
    Show/Hide
    <span class="caret"></span>
  </a>

  <ul class="dropdown-menu">
    <!-- dropdown menu links -->
    <li><a id="match" href="#"><i id="imatch" class="icon-ok icon-white active"></i> Match</a></li>
    <li><a id="unmatch" href="#"><i id="iunmatch" class="icon-ok icon-white active"></i>  Unmatch</a></li>
    <li><a id="proximity" href="#"><i id="iproximity" class="icon-ok icon-white active"></i>  Proximity</a></li>
    <li><a id="emptyrows" href="#"><i id="iemptyrows" class="icon-ok icon-white disabled"></i>  Empty rows</a></li>
  </ul>

</div>

    </div>
  </div>
  </form>
  {% endblock %}

{% block content %}

<div class="span12">
  <div class="accordion" id="accordion2">
    {% for name, qset in results %}
                      
    
    <div class="span6" {% if forloop.first%}style="margin-left: 0px;"{% endif %}>
      <span class="label label-inverse">{{name}}</span>

      {% for k,v in qset.items %}
      <div class="accordion-group">
        <div class="accordion-heading">
          <a id="a_collapse{{k|removespaces}}_{{name|removespaces}}" class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse{{k|removespaces}}_{{name|removespaces}}">{{k|removeh1}}</a>
        </div>
        <div id="collapse{{k|removespaces}}_{{name|removespaces}}" class="accordion-body collapse">
          <div class="accordion-inner">

            <table id="{{name|removespaces}}_{{k|removespaces}}" class="table table-bordered  table-hover table-striped">
              <thead></thead>

              <tbody>
                {% for t in v.list_ordered_tags %}
                <tr>
                  <td data-original-title="{{ t.tag }}" title="">{{ t.tag }}</td> 
                   <td data-original-title="{{ t.value }}" title="">{{ t.value }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endfor %}
  </div>
</div>
</div>  

{% endblock %}



{% comment %}
<script type="text/javascript" >
{% endcomment %}
{% block scriptextra %}


$("#collapseall").bind('click',function(e)
        { 
          e.preventDefault(); 
          e.stopPropagation();
          
          if ($(this).text().indexOf('Collapse')!==-1)
          {
            $(this).text('Expand all');
            change_name_collapse(false);
          }
          else
          {
              $(this).text('Collapse all');
              change_name_collapse(true);
          }
            
          return false;
        });

var match=false;
$("#match").bind('click',function(e)
{ 

          e.preventDefault(); 
          e.stopPropagation();
          {% for name, qset in results %}
            {% for k,v in qset.items %}

            show_hide_match(['{{name|removespaces}}_{{k|removespaces}}'], match);
          {% endfor %}
          {% endfor %}
          match = !match ;
          if (match)
          {
            $('#imatch').removeClass('icon-ok') 

          }
          else
          {
            $('#imatch').addClass('icon-ok')
          }
          return false;
});


var unmatch=false;
$("#unmatch").bind('click',function(e)
{ 

          e.preventDefault(); 
          e.stopPropagation();
          {% for name, qset in results %}
            {% for k,v in qset.items %}

            show_hide_unmatch(['{{name|removespaces}}_{{k|removespaces}}'], unmatch);
          {% endfor %}
          {% endfor %}
          unmatch = !unmatch ;
          if (unmatch)
          {
            $('#iunmatch').removeClass('icon-ok') 
            
          }
          else
          {
            $('#iunmatch').addClass('icon-ok')
          }
          return false;
});

var emptyrows=false;
$("#emptyrows").bind('click',function(e)
{ 

          e.preventDefault(); 
          e.stopPropagation();
          {% for name, qset in results %}
            {% for k,v in qset.items %}

            show_hide_empty_rows(['{{name|removespaces}}_{{k|removespaces}}'], emptyrows);
          {% endfor %}
          {% endfor %}
          emptyrows = !emptyrows ;
          if (emptyrows)
          {
            $('#iemptyrows').removeClass('icon-ok') 
            
          }
          else
          {
            $('#iemptyrows').addClass('icon-ok')
          }
          return false;
});



var proximity=false;
$("#proximity").bind('click',function(e)
{ 

          e.preventDefault(); 
          e.stopPropagation();
          {% for name, qset in results %}
            {% for k,v in qset.items %}

            show_hide_proximity(['{{name|removespaces}}_{{k|removespaces}}'], proximity);
          {% endfor %}
          {% endfor %}
          proximity = !proximity ;
          if (proximity)
          {
            $('#iproximity').removeClass('icon-ok') 
            
          }
          else
          {
            $('#iproximity').addClass('icon-ok')
          }
          return false;
});






function change_name_collapse(value)
{

  
    {% for name, qset in results %}
      {% for k,v in qset.items %}


    $("div[id^='collapse']").filter(function(){
    var regexp = /^collapse(.*)$/;
    return (this.id.match(regexp));
    }).each(function(){
    //this.innerHTML = this.id;
    console.log(this.id);
    var current = "{{name|removespaces}}_{{k|removespaces}}";
    if (this.id.indexOf(current))
    {
        if(value) { //expand
//            console.log("expand");
            $('#'+this.id).collapse('show');
        }
        else {  //collapse
//            console.log("collapse");
            $('#'+this.id).collapse('hide');
        }

    };
    });

      //show_hide_empty_rows(['{{name|removespaces}}_{{k|removespaces}}'], value);
      {% endfor %}
      {% endfor %}
      return false;
};

function hidecheckbox()
{
  console.log("togle");
  $('.checkbox').toggle();
}


myFunc = function(name)
{
  console.log(this);
  console.log(name);
  var current = this.id;
  current = current.replace("a_", "");
  current = current.split("_")[0];
  //console.log(this.parent);
  
   $('div[id]').filter(function () {
    return /^collapse.*$/.test(this.id);
}).each(function (name2) {
    //console.log(name2);
});




$("div[id^='collapse']").filter(function(){
    var regexp = /^collapse(.*)$/;
    return (this.id.match(regexp));
}).each(function(){
    //this.innerHTML = this.id;
    console.log(this.id);
    console.log(current);
    if (!this.id.indexOf(current))
    { 
      $('#'+this.id).collapse('toggle'); 
    };
});



};
$('body').on('click', '.accordion-toggle', myFunc);



/*

function highlight(text, text_to_highlight)
{
    inputText = document.getElementById("inputText")
    var innerHTML = inputText.innerHTML
    var index = innerHTML.indexOf(text);
    if ( index >= 0 )
    { 
        innerHTML = innerHTML.substring(0,index) + "
<span class='highlight'>" + innerHTML.substring(index,index+text.length) + "</span>
" + innerHTML.substring(index + text.length);
        inputText.innerHTML = innerHTML 
    }

}

*/

$.fn.textWidth = function() {
  var node, original, width;
  original = $(this).html();
  node = $("<span style='position:absolute;width:auto;left:-9999px'>" + original + "</span>");
  //node.css('font-family', $(this).css('font-family')).css('font-size', $(this).//css('font-size'));
  $('body').append(node);
  width = node.width();
  node.remove();
  return width;
};



$(function() {
  $('td').each(function() 
  {

    var content;
    content = $(this).text().replace(/\s+/gi, ' ');

    
    if ($(this).textWidth() > $(this).width()) {
    
      return $(this).tooltip({container:"body"});
    }
  });
});


{% for name, qset in results %}

{% if not forloop.first %}
{% for k,v in qset.items %}
/*
tablediffall_two('{{database_to_compare|removespaces}}_{{k|removespaces}}',['{{name|removespaces}}_{{k|removespaces}}'] )
*/
tablediffall_two('{{database_to_compare|removespaces}}_{{k|removespaces}}', ['{{name|removespaces}}_{{k|removespaces}}'])

{% endfor %}
{% endif %}


{% endfor %}

{% comment %}
</script>
{% endcomment %}


{% endblock %}