
{% load extra_tags %}
{% load markup questionnaire i18n %}


<div class="span8">
    <form name="qform" id="qform" action="dbEdit/{{fingerprint_id}}/{{questionset.questionnaire.pk}}/1" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="active_qs" id="active_qs" value="0">
        <input type="hidden" name="active_qs_sortid" id="active_qs_sortid" value="0">
        <input type="hidden" name="fingerprint_id" value="{{ fingerprint_id }}">
        <input type="hidden" name="users_db" value="{{ users_db }}">

    {% for k, qlist in questions_list %}

    <div id="qs_{{ k.sortid }}" class="{% if k.sortid == questionset.sortid %} {% else %} hide {% endif %} questionset">
    {% if k.sortid == questionset.sortid %}

    {% endif %}
    <div class="questionset-title" style="font-size:6px">
    <h3>{{ k.text|removeh1 }}</h3>
    </div>

        {% csrf_token %}

        <input type="hidden" name="questionset_id" value="{{ questionset.id }}">
    
        {% for question, qdict in qlist %}

        {% with errors|dictget:question.number as error %}

            <div class="question type_{{ qdict.qtype }} {% if error %} error prepend-top{% endif %}{{ qdict.qnum_class }}{{ qdict.qalpha_class }}" id="qc_{{ question.number }}" {{qdict.checkstring|safe}}>                
                {% if request.user.is_staff %}
                    <span class="pull-right">
                        <a href="admin/questionnaire/question/{{ question.id }}/">
                            ({% trans "edit" %} {{ question.number }})
                        </a>
                    </span>
                {% endif %}
                    
                {% if qdict.custom %}
                    {% if error %}
                        <div class="error">
                            {{ error }}
                        </div>
                    {% endif %}
                    {% include qdict.template %}
                {% else %}
                    <div class="question-text {% if qdict.required %}required{% endif %} {% if error %}text-error{% endif %} qtext_{{question.text|geths}}">
                        <span class="qnumber_{{question.text|geths}}">{{ question.display_number }}.</span>
                        <span class="qtext">{{ question.text|safe|removehs }}
                        {% if question.help_text %}
                        <div class="question-help-text" style="display: none;">
                            <span>{{ question.help_text|safe }}</span>
                        </div>

                    {% endif %}
                            </span>
                    </div>

                    <div class="answer qtext_{{question.text|geths}}">
                        {% if error %}
                            <div class="alert-message block-message text-error input">{{ error }}</div>
                        {% endif %}
                        {% include qdict.template %}
                    </div>
                {% endif %}


            </div> <!-- /question container -->

            {% if question.footer %}
                <div class="question-footer">
                    {{ question.footer|textile }}
                    <div class="clearfix"></div>
                </div>
            {% endif %}
        {% endwith %}


        {% endfor %}


        <div class="well questionset-submit">
            <!-- Previous | Next buttons -->
            <div class="span5 text-center">
            <!-- If Questionset is not the first (Introduction) or the final (Thank you) -->

                {% if k.prev %}
                    <a href="add/{{ questionset.questionnaire.pk }}/{{ k.prev.sortid }}" class="btn large primary" onclick="questionsets_handle(qs_{{ k.prev.sortid }});  return false;">{% trans "Previous" %}</a>
                {% endif %}
                {% if k.prev and k.next %}

                {% endif %}
                {% if k.next %}
                    <a href="add/{{ questionset.questionnaire.pk }}/{{ k.next.sortid }}" class="btn large primary" onclick="questionsets_handle(qs_{{ k.next.sortid }});  return false;">{% trans "Next" %}</a>
                {% endif %}




                <!-- First Questionset - Introduction -->

            </div>
            <div class="span2 text-right">
                {% if k.sortid != 0 %}
                    <input class="btn large btn-primary" name="submit" type="submit" value="{% trans 'Save' %}" />
                {% endif %}
                {% if k.sortid == 0 %}
                {% endif %}
                    <!-- Last Questionset - Thank You -->
                {% if k.sortid == 99 %}
                    <!--<input class="btn large btn-primary" name="submit" type="submit" value="{% trans 'Save' %}" />-->
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
    </form>

</div>

<!-- Fix later -->
<script src="static/js/vendor/bootstrap-tooltip.js"></script>
<script src="static/js/vendor/bootstrap-popover.js"></script>
<script src="static/js/fingerprint.js"></script>

<script type="text/javascript">

    {% block scriptextra %}

function validate(question_number)
{
    //console.log($('#'+question_number).val());
    question_number = question_number + "";
    question_number = question_number.replace(".","\\.");
    $.getJSON('api/validate?name='+$('#'+question_number).val(), function(data) {
      var items = [];
      console.log(data['contains'])
      if (data['contains'] == true)
      {
        $('#warning_'+question_number).addClass("show");
        $('#warning_'+question_number).removeClass("hide");
        $('#success_'+question_number).addClass("hide");
        $('#success_'+question_number).removeClass("show");


      } else {
        $('#warning_'+question_number).addClass("hide");
        $('#warning_'+question_number).removeClass("show");
        $('#success_'+question_number).addClass("show");
        $('#success_'+question_number).removeClass("hide");
      }

    });



};

    help_text_popover();

    {% endblock %}
</script>


